name: Deploy Project

# Different ways to add multiple events.
#on: pull_request
#on: [pull_request, workflow_dispatch]
on:
  pull_request:
    #types: [opened]
    types:
      - opened    # triggled whena pull request is opened
    branches: 
      - main      # main
      - 'dev-*'   # dev-new, dev-this-is-new ...
      - 'dev_*'   # dev_new, dev_this_is_new ...
      - 'feat/**' # feat/new, feat/new/button ...
    paths-ignore:
      - '.github/workflows/*'

  workflow_dispatch:

  push:
    branches: [main, 'dev-*', 'dev_*', 'feat/**']
    paths-ignore:
      - '.github/workflows/*'

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3

      - name: Install node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm test

  build:
    needs: [tests]
    runs-on: ubuntu-latest
    steps:
      - name: Get code
        uses: actions/checkout@v3

      - name: Install node
        uses: actions/setup-node@v3
        with:
          node-version: 18
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build project
        run: npm run build

      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist-files  # Name the artifact so it can be used in other jobs
          path: dist

  deploy:
    needs: [build]
    runs-on: ubuntu-latest
    steps:
      - name: Get build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist-files  # Inform the name of the artifact that must be downloaded
      
      - name: Output contents
        run: ls
      
      - name: Deploy
        run: echo "Deploying ..."